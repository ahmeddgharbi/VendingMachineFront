{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ghaahm\\\\frontend\\\\src\\\\Components\\\\pages\\\\Home.js\",\n    _s = $RefreshSig$();\n\nimport React, { useContext, useEffect, useState } from \"react\";\nimport { ProductContext, UserContext } from \"../../App\";\nimport NavBar from \"../Others/NavBar\";\nimport UserStatus from \"../Others/UserStatus\";\nimport \"./CommonStyle.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Home = () => {\n  _s();\n\n  const [products, setProducts] = useContext(ProductContext);\n  const [user, setUser] = useContext(UserContext);\n  const [session, setSession] = useState({});\n  useEffect(() => {\n    const session = JSON.parse(localStorage.getItem(\"session\"));\n    console.log(session);\n\n    if (session !== null && session !== void 0 && session.key) {\n      setSession(session);\n      fetch(`http://localhost:3005/api/users/verify-session/${session.key}/${session.user.email}`).then(res => res.json()).then(data => {\n        console.log(data);\n\n        if (!data.forceLogout) {\n          setSession({ ...session,\n            user: data.user\n          });\n        } else {\n          setSession({});\n          console.log('session destroyed');\n        }\n      });\n    }\n\n    fetch(\"http://localhost:3005/api/products/all\").then(res => res.json()).then(data => setProducts(data));\n  }, []);\n  useEffect(() => {\n    if (session.key) {\n      setUser(session.user);\n    }\n  }, [session]);\n\n  const handleOnToCart = (e, pid) => {\n    e.preventDefault();\n\n    if (!(session !== null && session !== void 0 && session.key)) {\n      alert(\"Please Login First\");\n    }\n\n    const thePd = products.find(pd => pd._id === pid);\n    let totalPrice = 0;\n    user.cart.map(it => {\n      totalPrice = totalPrice + it.cost;\n    });\n    console.log(totalPrice + thePd.cost, \"asd\", user.deposit);\n\n    if (user.username) {\n      if (user.role === \"seller\") {\n        alert(\"Please Login With an Buyer ID\");\n      } else if (user.role === \"buyer\") {\n        if (thePd.amountAvailable <= 0) {\n          alert(\"Out of Stock\");\n        } else if (totalPrice + thePd.cost > user.deposit) {\n          alert(\"Insufficient Balance\");\n        } else {\n          console.log(\"on click\");\n          e.preventDefault();\n          const requestOptions = {\n            method: \"PATCH\",\n            headers: {\n              \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n              pid: pid\n            })\n          };\n          fetch(`http://localhost:3005/api/users/addToCart/${user._id}`, requestOptions).then(response => response.json()).then(data => {\n            setUser(data);\n            console.log(\"Element added to cart\");\n          });\n        }\n      }\n    } else {\n      alert(\"Please Login First\");\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(NavBar, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this), (user === null || user === void 0 ? void 0 : user.username) && /*#__PURE__*/_jsxDEV(UserStatus, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 26\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: products ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row d-flex justify-content-center\",\n        children: products.map(pd => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-md-6 col-lg-3 py-3 product \",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"d-flex justify-content-center align-items-center\",\n            children: pd.productName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"d-flex justify-content-center align-items-center\",\n            children: [\"Cost: \", pd.cost]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 105,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"d-flex justify-content-center align-items-center\",\n            children: [\"Available:\", pd.amountAvailable]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"h6\", {\n            className: \"d-flex justify-content-center align-items-center\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: e => handleOnToCart(e, pd._id),\n              value: pd.cost,\n              className: \"btn-success rounded px-2 py-1\",\n              children: \"Add To Cart\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 113,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 112,\n            columnNumber: 15\n          }, this)]\n        }, Math.random() + Date.now(), true, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 19\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"d-flex justify-content-center\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: \"https://cdn.dribbble.com/users/1186261/screenshots/3718681/_______.gif\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 18\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Home, \"kerIowabOtzCLcxF2mdnMLw9vKY=\");\n\n_c = Home;\nexport default Home;\n\nvar _c;\n\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"sources":["C:/Users/ghaahm/frontend/src/Components/pages/Home.js"],"names":["React","useContext","useEffect","useState","ProductContext","UserContext","NavBar","UserStatus","Home","products","setProducts","user","setUser","session","setSession","JSON","parse","localStorage","getItem","console","log","key","fetch","email","then","res","json","data","forceLogout","handleOnToCart","e","pid","preventDefault","alert","thePd","find","pd","_id","totalPrice","cart","map","it","cost","deposit","username","role","amountAvailable","requestOptions","method","headers","body","stringify","response","productName","Math","random","Date","now"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,UAAhB,EAA4BC,SAA5B,EAAuCC,QAAvC,QAAuD,OAAvD;AACA,SAASC,cAAT,EAAyBC,WAAzB,QAA4C,WAA5C;AACA,OAAOC,MAAP,MAAmB,kBAAnB;AACA,OAAOC,UAAP,MAAuB,sBAAvB;AACA,OAAO,mBAAP;;;AAEA,MAAMC,IAAI,GAAG,MAAM;AAAA;;AACjB,QAAM,CAACC,QAAD,EAAWC,WAAX,IAA0BT,UAAU,CAACG,cAAD,CAA1C;AACA,QAAM,CAACO,IAAD,EAAOC,OAAP,IAAkBX,UAAU,CAACI,WAAD,CAAlC;AAEA,QAAM,CAACQ,OAAD,EAAUC,UAAV,IAAwBX,QAAQ,CAAC,EAAD,CAAtC;AAEAD,EAAAA,SAAS,CAAC,MAAM;AACd,UAAMW,OAAO,GAAGE,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,SAArB,CAAX,CAAhB;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAYP,OAAZ;;AACA,QAAIA,OAAJ,aAAIA,OAAJ,eAAIA,OAAO,CAAEQ,GAAb,EAAkB;AAChBP,MAAAA,UAAU,CAACD,OAAD,CAAV;AACAS,MAAAA,KAAK,CACF,kDAAiDT,OAAO,CAACQ,GAAI,IAAGR,OAAO,CAACF,IAAR,CAAaY,KAAM,EADjF,CAAL,CAGGC,IAHH,CAGSC,GAAD,IAASA,GAAG,CAACC,IAAJ,EAHjB,EAIGF,IAJH,CAISG,IAAD,IAAU;AACdR,QAAAA,OAAO,CAACC,GAAR,CAAYO,IAAZ;;AACA,YAAI,CAACA,IAAI,CAACC,WAAV,EAAuB;AACrBd,UAAAA,UAAU,CAAC,EAAE,GAAGD,OAAL;AAAcF,YAAAA,IAAI,EAAEgB,IAAI,CAAChB;AAAzB,WAAD,CAAV;AACD,SAFD,MAGK;AACHG,UAAAA,UAAU,CAAC,EAAD,CAAV;AACAK,UAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACD;AACF,OAbH;AAcD;;AACDE,IAAAA,KAAK,CAAC,wCAAD,CAAL,CACGE,IADH,CACSC,GAAD,IAASA,GAAG,CAACC,IAAJ,EADjB,EAEGF,IAFH,CAESG,IAAD,IAAUjB,WAAW,CAACiB,IAAD,CAF7B;AAGD,GAvBQ,EAuBN,EAvBM,CAAT;AAyBAzB,EAAAA,SAAS,CAAC,MAAM;AACd,QAAIW,OAAO,CAACQ,GAAZ,EAAiB;AACfT,MAAAA,OAAO,CAACC,OAAO,CAACF,IAAT,CAAP;AACD;AACF,GAJQ,EAIN,CAACE,OAAD,CAJM,CAAT;;AAMA,QAAMgB,cAAc,GAAG,CAACC,CAAD,EAAIC,GAAJ,KAAY;AACjCD,IAAAA,CAAC,CAACE,cAAF;;AACA,QAAI,EAACnB,OAAD,aAACA,OAAD,eAACA,OAAO,CAAEQ,GAAV,CAAJ,EAAmB;AACjBY,MAAAA,KAAK,CAAC,oBAAD,CAAL;AACD;;AACD,UAAMC,KAAK,GAAGzB,QAAQ,CAAC0B,IAAT,CAAeC,EAAD,IAAQA,EAAE,CAACC,GAAH,KAAWN,GAAjC,CAAd;AACA,QAAIO,UAAU,GAAG,CAAjB;AACA3B,IAAAA,IAAI,CAAC4B,IAAL,CAAUC,GAAV,CAAeC,EAAD,IAAQ;AACpBH,MAAAA,UAAU,GAAGA,UAAU,GAAGG,EAAE,CAACC,IAA7B;AACD,KAFD;AAGAvB,IAAAA,OAAO,CAACC,GAAR,CAAYkB,UAAU,GAAGJ,KAAK,CAACQ,IAA/B,EAAqC,KAArC,EAA4C/B,IAAI,CAACgC,OAAjD;;AACA,QAAIhC,IAAI,CAACiC,QAAT,EAAmB;AACjB,UAAIjC,IAAI,CAACkC,IAAL,KAAc,QAAlB,EAA4B;AAC1BZ,QAAAA,KAAK,CAAC,+BAAD,CAAL;AACD,OAFD,MAEO,IAAItB,IAAI,CAACkC,IAAL,KAAc,OAAlB,EAA2B;AAChC,YAAIX,KAAK,CAACY,eAAN,IAAyB,CAA7B,EAAgC;AAC9Bb,UAAAA,KAAK,CAAC,cAAD,CAAL;AACD,SAFD,MAEO,IAAIK,UAAU,GAAGJ,KAAK,CAACQ,IAAnB,GAA0B/B,IAAI,CAACgC,OAAnC,EAA4C;AACjDV,UAAAA,KAAK,CAAC,sBAAD,CAAL;AACD,SAFM,MAEA;AACLd,UAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AACAU,UAAAA,CAAC,CAACE,cAAF;AACA,gBAAMe,cAAc,GAAG;AACrBC,YAAAA,MAAM,EAAE,OADa;AAErBC,YAAAA,OAAO,EAAE;AAAE,8BAAgB;AAAlB,aAFY;AAGrBC,YAAAA,IAAI,EAAEnC,IAAI,CAACoC,SAAL,CAAe;AACnBpB,cAAAA,GAAG,EAAEA;AADc,aAAf;AAHe,WAAvB;AAOAT,UAAAA,KAAK,CACF,6CAA4CX,IAAI,CAAC0B,GAAI,EADnD,EAEHU,cAFG,CAAL,CAIGvB,IAJH,CAIS4B,QAAD,IAAcA,QAAQ,CAAC1B,IAAT,EAJtB,EAKGF,IALH,CAKSG,IAAD,IAAU;AACdf,YAAAA,OAAO,CAACe,IAAD,CAAP;AACAR,YAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ;AACD,WARH;AASD;AACF;AACF,KA7BD,MA6BO;AACLa,MAAAA,KAAK,CAAC,oBAAD,CAAL;AACD;AACF,GA3CD;;AA6CA,sBACE;AAAA,4BACE,QAAC,MAAD;AAAA;AAAA;AAAA;AAAA,YADF,EAEG,CAAAtB,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAEiC,QAAN,kBAAkB,QAAC,UAAD;AAAA;AAAA;AAAA;AAAA,YAFrB,eAIE;AAAK,MAAA,SAAS,EAAC,WAAf;AAAA,gBACGnC,QAAQ,gBAAC;AAAK,QAAA,SAAS,EAAC,mCAAf;AAAA,kBACPA,QAAQ,CAAC+B,GAAT,CAAcJ,EAAD,iBACZ;AAEE,UAAA,SAAS,EAAC,iCAFZ;AAAA,kCAKE;AAAI,YAAA,SAAS,EAAC,kDAAd;AAAA,sBACGA,EAAE,CAACiB;AADN;AAAA;AAAA;AAAA;AAAA,kBALF,eAQE;AAAI,YAAA,SAAS,EAAC,kDAAd;AAAA,iCACSjB,EAAE,CAACM,IADZ;AAAA;AAAA;AAAA;AAAA;AAAA,kBARF,eAWE;AAAI,YAAA,SAAS,EAAC,kDAAd;AAAA,qCACaN,EAAE,CAACU,eADhB;AAAA;AAAA;AAAA;AAAA;AAAA,kBAXF,eAeE;AAAI,YAAA,SAAS,EAAC,kDAAd;AAAA,mCACE;AACE,cAAA,OAAO,EAAGhB,CAAD,IAAOD,cAAc,CAACC,CAAD,EAAIM,EAAE,CAACC,GAAP,CADhC;AAEE,cAAA,KAAK,EAAED,EAAE,CAACM,IAFZ;AAGE,cAAA,SAAS,EAAC,+BAHZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,kBAfF;AAAA,WACOY,IAAI,CAACC,MAAL,KAAgBC,IAAI,CAACC,GAAL,EADvB;AAAA;AAAA;AAAA;AAAA,gBADD;AADO;AAAA;AAAA;AAAA;AAAA,cAAD,gBA4BA;AAAK,QAAA,SAAS,EAAC,+BAAf;AAAA,+BACP;AAAK,UAAA,GAAG,EAAC;AAAT;AAAA;AAAA;AAAA;AAAA;AADO;AAAA;AAAA;AAAA;AAAA;AA7BX;AAAA;AAAA;AAAA;AAAA,YAJF;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AAyCD,CA3HD;;GAAMjD,I;;KAAAA,I;AA6HN,eAAeA,IAAf","sourcesContent":["import React, { useContext, useEffect, useState } from \"react\";\r\nimport { ProductContext, UserContext } from \"../../App\";\r\nimport NavBar from \"../Others/NavBar\";\r\nimport UserStatus from \"../Others/UserStatus\";\r\nimport \"./CommonStyle.css\";\r\n\r\nconst Home = () => {\r\n  const [products, setProducts] = useContext(ProductContext);\r\n  const [user, setUser] = useContext(UserContext);\r\n  \r\n  const [session, setSession] = useState({});\r\n\r\n  useEffect(() => {\r\n    const session = JSON.parse(localStorage.getItem(\"session\"));\r\n    console.log(session);\r\n    if (session?.key) {\r\n      setSession(session);\r\n      fetch(\r\n        `http://localhost:3005/api/users/verify-session/${session.key}/${session.user.email}`\r\n      )\r\n        .then((res) => res.json())\r\n        .then((data) => {\r\n          console.log(data);\r\n          if (!data.forceLogout) {\r\n            setSession({ ...session, user: data.user });\r\n          }\r\n          else {\r\n            setSession({});\r\n            console.log('session destroyed')\r\n          }\r\n        });\r\n    }\r\n    fetch(\"http://localhost:3005/api/products/all\")\r\n      .then((res) => res.json())\r\n      .then((data) => setProducts(data));\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (session.key) {\r\n      setUser(session.user);\r\n    }\r\n  }, [session]);\r\n\r\n  const handleOnToCart = (e, pid) => {\r\n    e.preventDefault();\r\n    if (!session?.key) {\r\n      alert(\"Please Login First\");\r\n    }\r\n    const thePd = products.find((pd) => pd._id === pid);\r\n    let totalPrice = 0;\r\n    user.cart.map((it) => {\r\n      totalPrice = totalPrice + it.cost;\r\n    });\r\n    console.log(totalPrice + thePd.cost, \"asd\", user.deposit);\r\n    if (user.username) {\r\n      if (user.role === \"seller\") {\r\n        alert(\"Please Login With an Buyer ID\");\r\n      } else if (user.role === \"buyer\") {\r\n        if (thePd.amountAvailable <= 0) {\r\n          alert(\"Out of Stock\");\r\n        } else if (totalPrice + thePd.cost > user.deposit) {\r\n          alert(\"Insufficient Balance\");\r\n        } else {\r\n          console.log(\"on click\");\r\n          e.preventDefault();\r\n          const requestOptions = {\r\n            method: \"PATCH\",\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify({\r\n              pid: pid,\r\n            }),\r\n          };\r\n          fetch(\r\n            `http://localhost:3005/api/users/addToCart/${user._id}`,\r\n            requestOptions\r\n          )\r\n            .then((response) => response.json())\r\n            .then((data) => {\r\n              setUser(data);\r\n              console.log(\"Element added to cart\");\r\n            });\r\n        }\r\n      }\r\n    } else {\r\n      alert(\"Please Login First\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <NavBar></NavBar>\r\n      {user?.username && <UserStatus />}\r\n\r\n      <div className=\"container\">\r\n        {products?<div className=\"row d-flex justify-content-center\">\r\n          {products.map((pd) => (\r\n            <div\r\n              key={Math.random() + Date.now()}\r\n              className=\"col-md-6 col-lg-3 py-3 product \"\r\n            >\r\n              {}\r\n              <h3 className=\"d-flex justify-content-center align-items-center\">\r\n                {pd.productName}\r\n              </h3>\r\n              <h4 className=\"d-flex justify-content-center align-items-center\">\r\n                Cost: {pd.cost}\r\n              </h4>\r\n              <h4 className=\"d-flex justify-content-center align-items-center\">\r\n                Available:{pd.amountAvailable}\r\n              </h4>\r\n              {/* <h4  className=\"d-flex justify-content-center align-items-center\">SID: {pd.sellerId}</h4> */}\r\n              <h6 className=\"d-flex justify-content-center align-items-center\">\r\n                <button\r\n                  onClick={(e) => handleOnToCart(e, pd._id)}\r\n                  value={pd.cost}\r\n                  className=\"btn-success rounded px-2 py-1\"\r\n                >\r\n                  Add To Cart\r\n                </button>\r\n              </h6>\r\n            </div>\r\n          ))}\r\n        </div> : <div className=\"d-flex justify-content-center\">\r\n          <img src=\"https://cdn.dribbble.com/users/1186261/screenshots/3718681/_______.gif\"/>\r\n        </div>}\r\n          \r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n"]},"metadata":{},"sourceType":"module"}